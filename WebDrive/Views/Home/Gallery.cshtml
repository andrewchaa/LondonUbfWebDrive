<div id="page-content" class="clearfix">
	<div class="page-header position-relative">
		<h1>Web gallery<small><i class="icon-double-angle-right"></i> view and download pictures</small></h1>
	</div><!--/.page-header-->

	<div class="row-fluid">
	    
	    <div class="row-fluid">@Html.Partial("_Suggestions")</div>

	    <!--PAGE CONTENT BEGINS HERE-->
        @Html.Partial("_MessageBox")

	    <div class="row-fluid">
    
	        <div class="span12">
	            
	            <div class="widget-box">
	                
	                <div class="widget-header widget-header-flat" id="breadcrumbs">
	                    @Html.Partial("_Breadcrumb")
	                    <div class="widget-toolbar"><button class="btn btn-primary btn-small" id="btnUpload">Upload</button></div>
	                </div>
	                <div class="widget-body"><div class="widget-main">@Html.Partial("_Thumbnails")</div></div>
	            
	            </div><!-- /widget-box -->

	        </div><!--/span-->
            
	    </div>

	    <!--PAGE CONTENT ENDS HERE-->
	</div><!--/row-->
</div><!--/#page-content-->

<div id="dropbox" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-body" style="height: 400px;">
        <h5 class="text-center orange" style="padding-top: 180px;">Please drag and drop the file(s) to upload here...</h5>
    </div>
    <div class="modal-footer"><button class="btn btn-small" data-dismiss="modal" aria-hidden="true">Close</button></div>
</div>

<script type="text/javascript">

    var ImageViewModel = function() {
        var self = this;
        self.filesUploaded = ko.observableArray();
        self.breadcrumbs = ko.observableArray();
        self.recentDownloads = ko.observableArray();
        self.images = ko.observableArray();

        self.list = function (directory) {
            var api = '/api/thumbnails';
            if (directory) {
                api += '/' + directory
            }

            $.get(api, function (data) {
                $.each(data, function (i, val) {
                    self.images.push(val);
                });

//                self.images(data);
            });
        };

        self.click = function (thumbnail) {
            if (!!thumbnail.IsDirectory) {
                self.list(thumbnail.RelativePath);
                self.getBreadcrumbs(thumbnail.RelativePath);
            }
            console.log(thumbnail);
        };
        
        self.getBreadcrumbs = function (path) {
            $.get('/api/breadcrumbs/' + path, function (data) {
                self.breadcrumbs(data);
            });
        };

        self.clickBreadcrumb = function (item) {
            self.list(item.Path);
            self.getBreadcrumbs(item.Path);
        };

    };

    $(function() {
        var viewmodel = new ImageViewModel();
        ko.applyBindings(viewmodel);

        viewmodel.list();
        viewmodel.getBreadcrumbs('/');


    });

    

</script>