<h1>Web drive</h1>
<p>Browse and downlaod message files at the church</p>

<div class="row">
    <div class="span8">
        <table class="table table-condensed table-hover">
            <thead>
                <tr>
                    <th class="span5"></th>
                    <th class="span2"></th>
                </tr>
            </thead>
            <tbody data-bind="foreach: documents" id="fileList">
                <tr>
                    <td>
                        <i data-bind="css: { 'icon-folder-close': IsFolder, 'icon-file': !IsFolder }"></i> 
                        <a data-bind="text: Name, attr: { href: '#', title: Name, 'data-path': FullName, 'data-isfolder': IsFolder }"></a>
                    </td>
                    <td><span data-bind="text: DateModified">11:23 PM</span></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="span4">
        Somethings goes here
    </div>
</div>


<script type="text/javascript">
    $(function() {
        var DriveViewModel = function () {
            var self = this;
            self.documents = ko.observableArray();
            self.list = function (path) {
                var uri = 'api/folders';
                if (!!path) {
                    uri += path;
                }
                
                $.get(uri, function (data) {
                    self.documents(data);
                });
            };
            self.get = function (path) {
                window.location.href = 'api/documents' + path;
            };

        };

        var viewModel = new DriveViewModel();
        ko.applyBindings(viewModel);

        viewModel.list();

        $('#fileList').delegate('a', 'click', function (e) {
            e.preventDefault();

            var path = $(this).attr('data-path');
            console.log(path);
            var isFolder = $(this).attr('data-isfolder');
            if (!!isFolder) {
                viewModel.list(path);
            } else {
                viewModel.get(path);
            }
            
        });

    });

</script>
